/**
 * THREE.Terrain.js 2.0.0-20220705
 *
 * @author Isaac Sukin (http://www.isaacsukin.com/)
 * @license MIT
 */
!function(e){var e=e.noise={};function r(e,r,n){this.x=e,this.y=r,this.z=n}r.prototype.dot2=function(e,r){return this.x*e+this.y*r},r.prototype.dot3=function(e,r,n){return this.x*e+this.y*r+this.z*n};var t=[new r(1,1,0),new r(-1,1,0),new r(1,-1,0),new r(-1,-1,0),new r(1,0,1),new r(-1,0,1),new r(1,0,-1),new r(-1,0,-1),new r(0,1,1),new r(0,-1,1),new r(0,1,-1),new r(0,-1,-1)],a=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],E=new Array(512),u=new Array(512),g=(e.seed=function(e){0<e&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var r=0;r<256;r++){var n,n=1&r?a[r]^255&e:a[r]^e>>8&255;E[r]=E[r+256]=n,u[r]=u[r+256]=t[n%12]}},e.seed(Math.random()),.5*(Math.sqrt(3)-1)),T=(3-Math.sqrt(3))/6,n=1/3,i=1/6;function m(e){return e*e*e*(e*(6*e-15)+10)}function h(e,r,n){return(1-n)*e+n*r}e.simplex=function(e,r){var n,t,r,n=(e+r)*g,a=Math.floor(e+n),n=Math.floor(r+n),i=(a+n)*T,e=e-a+i,r=r-n+i,o,i,i=r<e?(o=1,0):(o=0,1),m=e-o+T,h=r-i+T,s=e-1+2*T,f=r-1+2*T,t=u[(a&=255)+E[n&=255]],o=u[a+o+E[n+i]],i=u[1+a+E[1+n]],a=.5-e*e-r*r,n=a<0?0:(a*=a)*a*t.dot2(e,r),a=.5-m*m-h*h,t=a<0?0:(a*=a)*a*o.dot2(m,h),e=.5-s*s-f*f,r=e<0?0:(e*=e)*e*i.dot2(s,f);return 70*(n+t+r)},e.perlin=function(e,r){var n=Math.floor(e),t=Math.floor(r),a=(e-=n,r-=t,u[(n&=255)+E[t&=255]].dot2(e,r)),i=u[n+E[1+t]].dot2(e,r-1),o=u[1+n+E[t]].dot2(e-1,r),n=u[1+n+E[1+t]].dot2(e-1,r-1),t=m(e);return h(h(a,o,t),h(i,n,t),m(r))}}(this),THREE.Terrain=function(e){var r={after:null,easing:THREE.Terrain.Linear,heightmap:THREE.Terrain.DiamondSquare,material:null,maxHeight:100,minHeight:-100,optimization:THREE.Terrain.NONE,frequency:2.5,steps:1,stretch:!0,turbulent:!1,xSegments:63,xSize:1024,ySegments:63,ySize:1024},n;for(n in e=e||{},r)r.hasOwnProperty(n)&&(e[n]=(void 0===e[n]?r:e)[n]);e.material=e.material||new THREE.MeshBasicMaterial({color:15623731});var t=new THREE.Object3D,a=(t.rotation.x=-.5*Math.PI,new THREE.Mesh(new THREE.PlaneGeometry(e.xSize,e.ySize,e.xSegments,e.ySegments),e.material)),i=THREE.Terrain.toArray1D(a.geometry.attributes.position.array);return e.heightmap instanceof HTMLCanvasElement||e.heightmap instanceof Image?THREE.Terrain.fromHeightmap(i,e):"function"==typeof e.heightmap?e.heightmap(i,e):console.warn("An invalid value was passed for `options.heightmap`: "+e.heightmap),THREE.Terrain.fromArray1D(a.geometry.attributes.position.array,i),THREE.Terrain.Normalize(a,e),t.add(a),t},THREE.Terrain.Normalize=function(e,r){var n=THREE.Terrain.toArray1D(e.geometry.attributes.position.array);r.turbulent&&THREE.Terrain.Turbulence(n,r),1<r.steps&&(THREE.Terrain.Step(n,r.steps),THREE.Terrain.Smooth(n,r)),THREE.Terrain.Clamp(n,r),"function"==typeof r.after&&r.after(n,r),THREE.Terrain.fromArray1D(e.geometry.attributes.position.array,n),e.geometry.computeBoundingSphere(),e.geometry.computeFaceNormals(),e.geometry.computeVertexNormals()},THREE.Terrain.NONE=0,THREE.Terrain.GEOMIPMAP=1,THREE.Terrain.GEOCLIPMAP=2,THREE.Terrain.POLYGONREDUCTION=3,THREE.Terrain.toArray2D=function(e,r){for(var n=new Array(r.xSegments+1),t=r.xSegments+1,a=r.ySegments+1,i,o,i=0;i<t;i++)for(n[i]=new Float32Array(r.ySegments+1),o=0;o<a;o++)n[i][o]=e[o*t+i];return n},THREE.Terrain.fromArray2D=function(e,r){for(var n=0,t=r.length;n<t;n++)for(var a=0,i=r[n].length;a<i;a++)e[a*t+n]=r[n][a]},THREE.Terrain.toArray1D=function(e){for(var r=new Float32Array(e.length/3),n=0,t=r.length;n<t;n++)r[n]=e[3*n+2];return r},THREE.Terrain.fromArray1D=function(e,r){for(var n=0,t=Math.min(e.length/3,r.length);n<t;n++)e[3*n+2]=r[n]},THREE.Terrain.heightmapArray=function(e,r){var n=new Array((r.xSegments+1)*(r.ySegments+1)),t=n.length,a;return n.fill(0),r.minHeight=r.minHeight||0,r.maxHeight=void 0===r.maxHeight?1:r.maxHeight,r.stretch=r.stretch||!1,e(n,r),THREE.Terrain.Clamp(n,r),n},THREE.Terrain.Linear=function(e){return e},THREE.Terrain.EaseIn=function(e){return e*e},THREE.Terrain.EaseOut=function(e){return-e*(e-2)},THREE.Terrain.EaseInOut=function(e){return e*e*(3-2*e)},THREE.Terrain.InEaseOut=function(e){var e=2*e-1;return.5*e*e*e+.5},THREE.Terrain.EaseInWeak=function(e){return Math.pow(e,1.55)},THREE.Terrain.EaseInStrong=function(e){return e*e*e*e*e*e*e},THREE.Terrain.fromHeightmap=function(e,r){for(var n=document.createElement("canvas"),t=n.getContext("2d"),a=r.ySegments+1,i=r.xSegments+1,o=r.maxHeight-r.minHeight,m=(n.width=i,n.height=a,t.drawImage(r.heightmap,0,0,n.width,n.height),t.getImageData(0,0,n.width,n.height).data),h=0;h<a;h++)for(var s=0;s<i;s++){var f=h*i+s,E=4*f;e[f]=(m[E]+m[1+E]+m[2+E])/765*o+r.minHeight}},THREE.Terrain.toHeightmap=function(e,r){var n=void 0!==r.maxHeight,t=void 0!==r.minHeight,a=n?r.maxHeight:-1/0,i=t?r.minHeight:1/0;if(!n||!t){for(var o=a,m=i,h=2,s=e.length;h<s;h+=3)e[h]>o&&(o=e[h]),e[h]<m&&(m=e[h]);n||(a=o),t||(i=m)}for(var n=r.heightmap instanceof HTMLCanvasElement?r.heightmap:document.createElement("canvas"),t=n.getContext("2d"),f=r.ySegments+1,E=r.xSegments+1,u=a-i,r=(n.width=E,n.height=f,t.createImageData(n.width,n.height)),g=r.data,T=0;T<f;T++)for(var l=0;l<E;l++){var c=T*E+l,d=4*c;g[d]=g[1+d]=g[2+d]=Math.round((e[3*c+2]-i)/u*255),g[3+d]=255}return t.putImageData(r,0,0),n},THREE.Terrain.Clamp=function(e,r){var n=1/0,t=-1/0,a=e.length,i;for(r.easing=r.easing||THREE.Terrain.Linear,i=0;i<a;i++)e[i]<n&&(n=e[i]),e[i]>t&&(t=e[i]);var o=t-n,m="number"!=typeof r.maxHeight?t:r.maxHeight,h="number"!=typeof r.minHeight?n:r.minHeight,s=!r.stretch&&t<m?t:m,f=!r.stretch&&h<n?n:h,E=s-f;for(s<f&&(E=(s=m)-f),i=0;i<a;i++)e[i]=r.easing((e[i]-n)/o)*E+h},THREE.Terrain.Edges=function(e,r,n,t,a,i){var o=Math.floor(t/(r.xSize/r.xSegments))||1,m=Math.floor(t/(r.ySize/r.ySegments))||1,h=n?r.maxHeight:r.minHeight,s=n?Math.max:Math.min,f=r.xSegments+1,E=r.ySegments+1,u,g,T,l,c;for(a=a||THREE.Terrain.EaseInOut,"object"!=typeof i&&(i={top:!0,bottom:!0,left:!0,right:!0}),u=0;u<f;u++)for(g=0;g<m;g++)T=a(1-g/m),l=g*f+u,c=(r.ySegments-g)*f+u,i.top&&(e[l]=s(e[l],(h-e[l])*T+e[l])),i.bottom&&(e[c]=s(e[c],(h-e[c])*T+e[c]));for(u=0;u<E;u++)for(g=0;g<o;g++)T=a(1-g/o),l=u*f+g,c=(r.ySegments-u)*f+(r.xSegments-g),i.left&&(e[l]=s(e[l],(h-e[l])*T+e[l])),i.right&&(e[c]=s(e[c],(h-e[c])*T+e[c]));THREE.Terrain.Clamp(e,{maxHeight:r.maxHeight,minHeight:r.minHeight,stretch:!0})},THREE.Terrain.RadialEdges=function(e,r,n,t,a){for(var i=n?r.maxHeight:r.minHeight,o=n?Math.max:Math.min,m=r.xSegments+1,h,s=.5*m,f=.5*(r.ySegments+1),E=r.xSize/r.xSegments,u=r.ySize/r.ySegments,g=.5*Math.min(r.xSize,r.ySize)-t,T,l,c,d,c,T=0;T<m;T++)for(l=0;l<f;l++)d=l*m+T,(c=Math.min(g,Math.sqrt((s-T)*E*(s-T)*E+(f-l)*u*(f-l)*u)-t))<0||(c=a(c/g),e[d]=o(e[d],(i-e[d])*c+e[d]),e[d=(r.ySegments-l)*m+T]=o(e[d],(i-e[d])*c+e[d]))},THREE.Terrain.Smooth=function(e,r,n){for(var t=new Float32Array(e.length),a=0,i=r.xSegments+1,o=r.ySegments+1;a<i;a++)for(var m=0;m<o;m++){for(var h=0,s=0,f=-1;f<=1;f++)for(var E=-1;E<=1;E++){var u=(m+f)*i+a+E;void 0!==e[u]&&0<=a+E&&0<=m+f&&a+E<i&&m+f<o&&(h+=e[u],s++)}t[m*i+a]=h/s}for(var g=1/(1+(n=n||0)),T=0,l=e.length;T<l;T++)e[T]=(t[T]+e[T]*n)*g},THREE.Terrain.SmoothMedian=function(e,r){for(var n=new Float32Array(e.length),t=[],a=[],i=function(e,r){return t[e]-t[r]},o=0,m=r.xSegments+1,h=r.ySegments+1;o<m;o++)for(var s=0;s<h;s++){t.length=0,a.length=0;for(var f=-1;f<=1;f++)for(var E=-1;E<=1;E++){var u=(s+f)*m+o+E;void 0!==e[u]&&0<=o+E&&0<=s+f&&o+E<m&&s+f<h&&(t.push(e[u]),a.push(u))}a.sort(i);var g=Math.floor(.5*a.length),g,g=a.length%2==1?e[a[g]]:.5*(e[a[g-1]]+e[a[g]]);n[s*m+o]=g}for(var T=0,l=e.length;T<l;T++)e[T]=n[T]},THREE.Terrain.SmoothConservative=function(e,r,n){for(var t=new Float32Array(e.length),a=0,i=r.xSegments+1,o=r.ySegments+1;a<i;a++)for(var m=0;m<o;m++){for(var h=-1/0,s=1/0,f=-1;f<=1;f++)for(var E=-1;E<=1;E++){var u=(m+f)*i+a+E;void 0!==e[u]&&f&&E&&0<=a+E&&0<=m+f&&a+E<i&&m+f<o&&(e[u]<s&&(s=e[u]),e[u]>h&&(h=e[u]))}var g=m*i+a,T,l,h,s;"number"==typeof n&&(h=(l=s+(T=.5*(h-s)))+T*n,s=l-T*n),t[g]=e[g]>h?h:e[g]<s?s:e[g]}for(var c=0,d=e.length;c<d;c++)e[c]=t[c]},THREE.Terrain.Step=function(e,r){var n=0,t=0,a=e.length,i=Math.floor(a/r),o=new Array(a),m=new Array(r);for(void 0===r&&(r=Math.floor(Math.pow(.5*a,.25))),n=0;n<a;n++)o[n]=e[n];for(o.sort(function(e,r){return e-r}),n=0;n<r;n++){for(var h=o.slice(n*i,(n+1)*i),s=0,f=h.length,t=0;t<f;t++)s+=h[t];m[n]={min:h[0],max:h[h.length-1],avg:s/f}}for(n=0;n<a;n++){var E=e[n];for(t=0;t<r;t++)if(E>=m[t].min&&E<=m[t].max){e[n]=m[t].avg;break}}},THREE.Terrain.Turbulence=function(e,r){for(var n=r.maxHeight-r.minHeight,t=0,a=e.length;t<a;t++)e[t]=r.minHeight+Math.abs(2*(e[t]-r.minHeight)-n)},THREE.Terrain.MultiPass=function(e,r,n){var t={},a;for(a in r)r.hasOwnProperty(a)&&(t[a]=r[a]);for(var i=r.maxHeight-r.minHeight,o=0,m=n.length;o<m;o++){var h,s=.5*(i-i*(void 0===n[o].amplitude?1:n[o].amplitude));t.maxHeight=r.maxHeight-s,t.minHeight=r.minHeight+s,t.frequency=(void 0===n[o].frequency?r:n[o]).frequency,n[o].method(e,t)}},THREE.Terrain.Curve=function(e,r,n){for(var t=.5*(r.maxHeight-r.minHeight),a=r.frequency/(Math.min(r.xSegments,r.ySegments)+1),i=0,o=r.xSegments+1,m=r.ySegments+1;i<o;i++)for(var h=0;h<m;h++)e[h*o+i]+=n(i*a,h*a)*t},THREE.Terrain.Cosine=function(e,r){for(var n=.5*(r.maxHeight-r.minHeight),t=r.frequency*Math.PI/(Math.min(r.xSegments,r.ySegments)+1),a=Math.random()*Math.PI*2,i=0,o=r.xSegments+1;i<o;i++)for(var m=0,h=r.ySegments+1;m<h;m++)e[m*o+i]+=n*(Math.cos(i*t+a)+Math.cos(m*t+a))},THREE.Terrain.CosineLayers=function(e,r){THREE.Terrain.MultiPass(e,r,[{method:THREE.Terrain.Cosine,frequency:2.5},{method:THREE.Terrain.Cosine,amplitude:.1,frequency:12},{method:THREE.Terrain.Cosine,amplitude:.05,frequency:15},{method:THREE.Terrain.Cosine,amplitude:.025,frequency:20}])},THREE.Terrain.DiamondSquare=function(e,r){for(var n=THREE.Math.ceilPowerOfTwo(Math.max(r.xSegments,r.ySegments)+1),t=n+1,a=[],i=r.maxHeight-r.minHeight,o,m,h=r.xSegments+1,s=r.ySegments+1,o=0;o<=n;o++)a[o]=new Float64Array(n+1);for(var f=n;2<=f;f/=2){var E=Math.round(.5*f),u=Math.round(f),g,T,l,c,d;for(i/=2,g=0;g<n;g+=u)for(T=0;T<n;T+=u)c=Math.random()*i*2-i,l=a[g][T]+a[g+u][T]+a[g][T+u]+a[g+u][T+u],l*=.25,a[g+E][T+E]=l+c;for(g=0;g<n;g+=E)for(T=(g+E)%f;T<n;T+=f)c=Math.random()*i*2-i,l=.25*(l=a[(g-E+t)%t][T]+a[(g+E)%t][T]+a[g][(T+E)%t]+a[g][(T-E+t)%t])+c,a[g][T]=l,0===g&&(a[n][T]=l),0===T&&(a[g][n]=l)}for(o=0;o<h;o++)for(m=0;m<s;m++)e[m*h+o]+=a[o][m]},THREE.Terrain.Fault=function(e,r){for(var n=Math.sqrt(r.xSegments*r.xSegments+r.ySegments*r.ySegments),t=n*r.frequency,a,i=.5*(r.maxHeight-r.minHeight)/t,o=Math.min(r.xSize/r.xSegments,r.ySize/r.ySegments)*r.frequency,m=0;m<t;m++)for(var h=Math.random(),s=Math.sin(h*Math.PI*2),f=Math.cos(h*Math.PI*2),E=Math.random()*n-.5*n,u=0,g=r.xSegments+1;u<g;u++)for(var T=0,l=r.ySegments+1;T<l;T++){var c=s*u+f*T-E;o<c?e[T*g+u]+=i:c<-o?e[T*g+u]-=i:e[T*g+u]+=Math.cos(c/o*Math.PI*2)*i}},THREE.Terrain.Hill=function(e,r,n,t){for(var a=2*r.frequency,i=a*a*10,o=r.maxHeight-r.minHeight,m=o/(a*a),h=o/a,o=Math.min(r.xSize,r.ySize),s=o/(a*a),f=o/a,E=(n=n||THREE.Terrain.Influences.Hill,{x:0,y:0}),u=0;u<i;u++){var g=Math.random()*(f-s)+s,T=Math.random()*(h-m)+m,l=0-g,c=r.xSize+g,d=r.ySize+g;E.x=Math.random(),E.y=Math.random(),"function"==typeof t&&t(E),THREE.Terrain.Influence(e,r,n,E.x,E.y,g,T,THREE.AdditiveBlending,THREE.Terrain.EaseInStrong)}},THREE.Terrain.HillIsland=function(){var t=function(e){var r=Math.random()*Math.PI*2;e.x=.5+Math.cos(r)*e.x*.4,e.y=.5+Math.sin(r)*e.y*.4};return function(e,r,n){THREE.Terrain.Hill(e,r,n,t)}}(),!function(){function E(e,r,n,t,a){for(var i=n*t+r,o=0,m;o<3;o++){switch(Math.floor(8*Math.random())){case 0:r++;break;case 1:r--;break;case 2:n++;break;case 3:n--;break;case 4:r++,n++;break;case 5:r++,n--;break;case 6:r--,n++;break;case 7:r--,n--;break}var h=n*t+r;if(void 0!==e[h]){if(e[h]<e[i])return E(e,r,n,t,a),undefined}else if(Math.random()<.2)return e[i]+=a,undefined}e[i]+=a}THREE.Terrain.Particles=function(e,r){for(var n=Math.sqrt(r.xSegments*r.xSegments+r.ySegments*r.ySegments)*r.frequency*300,t=r.xSegments+1,a=(r.maxHeight-r.minHeight)/n*1e3,i=Math.floor(Math.random()*r.xSegments),o=Math.floor(Math.random()*r.ySegments),m=.2*Math.random()-.1,h=.2*Math.random()-.1,s=0;s<n;s++){E(e,i,o,t,a);var f=Math.random()*Math.PI*2;s%1e3==0&&(m=.2*Math.random()-.1,h=.2*Math.random()-.1),s%100==0&&(i=Math.floor(r.xSegments*(.5+m)+Math.cos(f)*Math.random()*r.xSegments*(.5-Math.abs(m))),o=Math.floor(r.ySegments*(.5+h)+Math.sin(f)*Math.random()*r.ySegments*(.5-Math.abs(h))))}}}(),THREE.Terrain.Perlin=function(e,r){noise.seed(Math.random());for(var n=.5*(r.maxHeight-r.minHeight),t=(Math.min(r.xSegments,r.ySegments)+1)/r.frequency,a=0,i=r.xSegments+1;a<i;a++)for(var o=0,m=r.ySegments+1;o<m;o++)e[o*i+a]+=noise.perlin(a/t,o/t)*n},THREE.Terrain.PerlinDiamond=function(e,r){THREE.Terrain.MultiPass(e,r,[{method:THREE.Terrain.Perlin},{method:THREE.Terrain.DiamondSquare,amplitude:.75},{method:function(e,r){return THREE.Terrain.SmoothMedian(e,r)}}])},THREE.Terrain.PerlinLayers=function(e,r){THREE.Terrain.MultiPass(e,r,[{method:THREE.Terrain.Perlin,frequency:1.25},{method:THREE.Terrain.Perlin,amplitude:.05,frequency:2.5},{method:THREE.Terrain.Perlin,amplitude:.35,frequency:5},{method:THREE.Terrain.Perlin,amplitude:.15,frequency:10}])},THREE.Terrain.Simplex=function(e,r){noise.seed(Math.random());for(var n=.5*(r.maxHeight-r.minHeight),t=2*(Math.min(r.xSegments,r.ySegments)+1)/r.frequency,a=0,i=r.xSegments+1;a<i;a++)for(var o=0,m=r.ySegments+1;o<m;o++)e[o*i+a]+=noise.simplex(a/t,o/t)*n},THREE.Terrain.SimplexLayers=function(e,r){THREE.Terrain.MultiPass(e,r,[{method:THREE.Terrain.Simplex,frequency:1.25},{method:THREE.Terrain.Simplex,amplitude:.5,frequency:2.5},{method:THREE.Terrain.Simplex,amplitude:.25,frequency:5},{method:THREE.Terrain.Simplex,amplitude:.125,frequency:10},{method:THREE.Terrain.Simplex,amplitude:.0625,frequency:20}])},!function(){function o(e,r,n,t,a,i){if(!(t<n)){for(var o=0,m=0,h=t,s=t,f=Math.floor(t/n),E=-f,u=-f,o=0,g,T;o<=h;o+=f){for(m=0;m<=s;m+=f){var l=m*h+o;if(i[l]=Math.random()*a,!(E<0&&u<0)){for(var c=i[l],d=i[m*h+(o-f)]||c,H=i[(m-f)*h+o]||c,v=i[(m-f)*h+(o-f)]||c,y=E;y<o;y++)for(var M=u,x,p,x,S,R;M<m;M++){y===E&&M===u||((x=M*h+y)<0||(i[x]=(x=(M-u)/f)*((p=(y-E)/f)*c+(1-p)*d)+(1-x)*(p*H+(1-p)*v)))}u=m}}E=o,u=-f}for(o=0,h=r.xSegments+1;o<h;o++)for(m=0,s=r.ySegments+1;m<s;m++){e[m*h+o]+=i[m*t+o]}}}THREE.Terrain.Value=function(e,r){for(var n=THREE.Math.ceilPowerOfTwo(Math.max(r.xSegments,r.ySegments)+1),t=new Float64Array((n+1)*(n+1)),a=r.maxHeight-r.minHeight,i=2;i<7;i++)o(e,r,Math.pow(2,i),n,a*Math.pow(2,2.4-1.2*i),t);THREE.Terrain.Clamp(e,{maxHeight:r.maxHeight,minHeight:r.minHeight,stretch:!0})}}(),THREE.Terrain.Weierstrass=function(e,r){for(var n=.5*(r.maxHeight-r.minHeight),t=Math.random()<.5?1:-1,a=Math.random()<.5?1:-1,i=+Math.random()+.5,o=+Math.random()+.5,m=.025+.1*Math.random(),h=2*Math.random()-1,s=+Math.random()+.5,f=+Math.random()+.5,E=.025+.1*Math.random(),u=2*Math.random()-1,g=0,T=r.xSegments+1;g<T;g++)for(var l=0,c=r.ySegments+1;l<c;l++){for(var d=0,H=0;H<20;H++){var v=Math.pow(1+i,-H)*Math.sin(Math.pow(1+o,H)*(g+.25*Math.cos(l)+h*l)*m),y=Math.pow(1+s,-H)*Math.sin(Math.pow(1+f,H)*(l+.25*Math.cos(g)+u*g)*E);d-=Math.exp(t*v*v+a*y*y)}e[l*T+g]+=d*n}THREE.Terrain.Clamp(e,r)},THREE.Terrain.generateBlendedMaterial=function(t,e){function r(e){return e===(0|e)?e+".0":e+""}for(var n="",a="",i=t[0].texture.repeat,o=t[0].texture.offset,m=0,h=t.length;m<h;m++)if(t[m].texture.wrapS=t[m].wrapT=THREE.RepeatWrapping,t[m].texture.needsUpdate=!0,n+="uniform sampler2D texture_"+m+";\n",0!==m){var s=t[m].levels,f=t[m].glsl,E=void 0!==s,u=t[m].texture.repeat,g=t[m].texture.offset;if(E){s[1]-s[0]<1&&--s[0],s[3]-s[2]<1&&(s[3]+=1);for(var T=0;T<s.length;T++)s[T]=r(s[T])}var E=E?"1.0 - smoothstep("+s[0]+", "+s[1]+", vPosition.z) + smoothstep("+s[2]+", "+s[3]+", vPosition.z)":f;a+="        color = mix( texture2D( texture_"+m+", MyvUv * vec2( "+r(u.x)+", "+r(u.y)+" ) + vec2( "+r(g.x)+", "+r(g.y)+" ) ), color, max(min("+E+", 1.0), 0.0));\n"}var l="float slope = acos(max(min(dot(myNormal, vec3(0.0, 0.0, 1.0)), 1.0), -1.0));\n    diffuseColor = vec4( diffuse, opacity );\n    vec4 color = texture2D( texture_0, MyvUv * vec2( "+r(i.x)+", "+r(i.y)+" ) + vec2( "+r(o.x)+", "+r(o.y)+" ) ); // base\n"+a+"    diffuseColor = color;\n",c=n+"\nvarying vec2 MyvUv;\nvarying vec3 vPosition;\nvarying vec3 myNormal;\n",i=e||new THREE.MeshLambertMaterial;return i.onBeforeCompile=function(e){e.vertexShader=e.vertexShader.replace("#include <common>","varying vec2 MyvUv;\nvarying vec3 vPosition;\nvarying vec3 myNormal;\n#include <common>"),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>","MyvUv = uv;\nvPosition = position;\nmyNormal = normal;\n#include <uv_vertex>"),e.fragmentShader=e.fragmentShader.replace("#include <common>",c+"\n#include <common>"),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",l);for(var r=0,n=t.length;r<n;r++)e.uniforms["texture_"+r]={type:"t",value:t[r].texture}},i},THREE.Terrain.ScatterMeshes=function(e,r){if(!r.mesh)return console.error("options.mesh is required for THREE.Terrain.ScatterMeshes but was not passed"),undefined;r.scene||(r.scene=new THREE.Object3D);var n={spread:.025,smoothSpread:0,sizeVariance:.1,randomness:Math.random,maxSlope:.6283185307179586,maxTilt:1/0,w:0,h:0},t;for(t in n)n.hasOwnProperty(t)&&(r[t]=(void 0===r[t]?n:r)[t]);for(var a="number"==typeof r.spread,i,o,m=1/r.smoothSpread,h=2*r.sizeVariance,s=new THREE.Vector3,f=new THREE.Vector3,E=new THREE.Vector3,u=new THREE.Vector3,g=r.mesh.up.clone().applyAxisAngle(new THREE.Vector3(1,0,0),.5*Math.PI),T=(a&&(o="number"==typeof(i=r.randomness())?Math.random:function(e){return i[e]}),(e=e.toNonIndexed()).attributes.position.array),l=0;l<e.attributes.position.array.length;l+=9){s.set(T[l+0],T[l+1],T[l+2]),f.set(T[l+3],T[l+4],T[l+5]),E.set(T[l+6],T[l+7],T[l+8]),THREE.Triangle.getNormal(s,f,E,u);var c=!1,d,d,c,c,c,c;a?(d=o(l/9))<r.spread?c=!0:d<r.spread+r.smoothSpread&&(c=THREE.Terrain.EaseInOut((d-r.spread)*m)*r.spread>Math.random()):c=r.spread(s,l/9,u,l),c&&(u.angleTo(g)>r.maxSlope||((d=r.mesh.clone()).position.addVectors(s,f).add(E).divideScalar(3),0<r.maxTilt&&(c=d.position.clone().add(u),d.lookAt(c),(c=u.angleTo(g))>r.maxTilt&&(c=r.maxTilt/c,d.rotation.x*=c,d.rotation.y*=c,d.rotation.z*=c)),d.rotation.x+=.5*Math.PI,d.rotateY(2*Math.random()*Math.PI),r.sizeVariance&&(c=Math.random()*h-r.sizeVariance,d.scale.x=d.scale.z=1+c,d.scale.y+=c),d.updateMatrix(),r.scene.add(d)))}return r.scene},THREE.Terrain.ScatterHelper=function(e,r,n,t){n=n||1,t=t||.25,r.frequency=r.frequency||2.5;var a={},i;for(i in r)r.hasOwnProperty(i)&&(a[i]=r[i]);a.xSegments*=2,a.stretch=!0,a.maxHeight=1,a.minHeight=0;for(var o=THREE.Terrain.heightmapArray(e,a),m=0,h=o.length;m<h;m++)(m%n||Math.random()>t)&&(o[m]=1);return function(){return o}},THREE.Terrain.Influences={Mesa:function(e){return 1.25*Math.min(.8,Math.exp(-e*e))},Hole:function(e){return-THREE.Terrain.Influences.Mesa(e)},Hill:function(e){return e<0?(e+1)*(e+1)*(3-2*(e+1)):1-e*e*(3-2*e)},Valley:function(e){return-THREE.Terrain.Influences.Hill(e)},Dome:function(e){return-(e+1)*(e-1)},Flat:function(e){return 0},Volcano:function(e){return.94-.32*(Math.abs(2*e)+Math.cos(2*Math.PI*Math.abs(e)+.4))}},THREE.Terrain.Influence=function(e,r,n,t,a,i,o,m,h){n=n||THREE.Terrain.Influences.Hill,t=void 0===t?.5:t,a=void 0===a?.5:a,i=void 0===i?64:i,o=void 0===o?64:o,m=void 0===m?THREE.NormalBlending:m,h=h||THREE.Terrain.EaseIn;for(var s=r.xSegments+1,f,E=s*t,u=(r.ySegments+1)*a,g=r.xSize/r.xSegments,T=r.ySize/r.ySegments,t=i/g,a=i/T,l=1/i,r=Math.ceil(E-t),c=Math.floor(E+t),d=Math.ceil(u-a),H=Math.floor(u+a),v=r;v<c;v++)for(var y=d;y<H;y++){var M=y*s+v,x=(v-E)*g,p=(y-u)*T,S=Math.sqrt(x*x+p*p),R=S*l,x=x*l,p=p*l,w=n(R,x,p)*o*(1-h(R,x,p));i<S||void 0===e[M]||(m===THREE.AdditiveBlending?e[M]+=w:m===THREE.SubtractiveBlending?e[M]-=w:m===THREE.MultiplyBlending?e[M]*=w:m===THREE.NoBlending?e[M]=w:m===THREE.NormalBlending?e[M]=h(R,x,p)*e[M]+w:"function"==typeof m&&(e[M]=m(e[M].z,w,R,x,p)))}};
//# sourceMappingURL=THREE.Terrain.min.js.map